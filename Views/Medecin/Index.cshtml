@model IEnumerable<MedicalOfficeManagement.Controllers.StaffVM>

@{
    ViewData["Title"] = "Doctors";
    var isAdmin = User.IsInRole(nameof(AppRole.Admin));
}

<div class="space-y-6">
    @await Html.PartialAsync("Partials/PageHeader", new PageHeaderModel
    {
        Title = "Cabinet Staff Directory",
        Subtitle = "Manage all registered doctors and administrative staff.",
        ContextTag = "Directory",
        RoleBadge = isAdmin ? "Admin" : "View only",
        RoleTone = isAdmin ? "success" : "warning",
        Actions = new []
        {
            new ToolbarAction { Label = "Add New Staff", Href = Url.Action("Create", "Medecin"), Style = "primary" }
        }
    })

    @await Html.PartialAsync("Partials/TableShell", new TableShellModel
    {
        Title = "Staff roster",
        Description = "Role, specialty, and contact context.",
        TableContent = @<text>
            <table class="w-full text-left">
                <thead>
                    <tr>
                        <th>Member Information</th>
                        <th class="text-center">Role</th>
                        <th>Specialty</th>
                        <th>Address</th>
                        <th class="text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="px-4 py-3">
                                <div class="flex items-center gap-3">
                                    <div class="h-10 w-10 rounded-full @(item.Role == "Medecin" ? "bg-brand-50 text-brand-700" : "bg-green-50 text-green-700") flex items-center justify-center font-bold">
                                        @item.NomPrenom.Substring(0, 1).ToUpper()
                                    </div>
                                    <div>
                                        <div class="text-sm font-semibold text-slate-900">@(item.Role == "Medecin" ? "Dr. " : "")@item.NomPrenom</div>
                                        <div class="text-xs text-slate-500">@item.Email</div>
                                    </div>
                                </div>
                            </td>
                            <td class="text-center">
                                <span class="badge @(item.Role == "Medecin" ? "info" : "success")">@item.Role</span>
                            </td>
                            <td class="text-sm text-slate-600">@item.Specialite</td>
                            <td class="text-sm text-slate-600">
                                <div class="flex items-center gap-1">
                                    <span class="iconify w-4 h-4 text-slate-400" data-icon="solar:map-point-bold"></span>
                                    @item.Address
                                </div>
                            </td>
                            <td class="text-right">
                                @await Html.PartialAsync("Partials/ActionMenu", new ActionMenuModel
                                {
                                    Items = new List<ActionMenuItem>
                                    {
                                        new ActionMenuItem { Label = "Edit", Href = item.Role == "Medecin" ? Url.Action("Edit", new { id = item.MedecinId }) : Url.Action("EditStaff", new { id = item.UserId }), Tone = "warning", Disabled = !isAdmin },
                                        new ActionMenuItem { Label = "Delete", Href = Url.Action("Delete", new { id = item.Role == "Medecin" ? item.MedecinId : null, userId = item.Role != "Medecin" ? item.UserId : null }), Tone = "danger", Disabled = !isAdmin }
                                    }
                                })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </text>
    })
</div>
