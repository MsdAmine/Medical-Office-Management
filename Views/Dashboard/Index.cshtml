@* File: Views/Dashboard/Index.cshtml *@
@model MedicalOfficeManagement.ViewModels.Dashboard.DashboardViewModel

@{
    ViewBag.Title = "Dashboard";
    var primaryCta = "inline-flex items-center gap-2 rounded-xl bg-brand-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500";
    var secondaryCta = "inline-flex items-center gap-2 rounded-xl border border-brand-200 bg-white px-4 py-2 text-sm font-semibold text-brand-700 hover:border-brand-300 hover:bg-brand-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500";
    var statusBadgeClass = Model.ClinicStatusTone == "success"
        ? "bg-emerald-100 text-emerald-700"
        : "bg-amber-100 text-amber-700";
    var isAdmin = User.IsInRole(nameof(AppRole.Admin));
    var isPhysician = User.IsInRole(nameof(AppRole.Physician)) || User.IsInRole(nameof(AppRole.Nurse));
    var isReception = User.IsInRole(nameof(AppRole.Receptionist));
    var roleIntent = isAdmin
        ? "Operational oversight and escalation control"
        : isPhysician
            ? "Patient care and clinical priorities"
            : isReception
                ? "Arrivals, scheduling, and patient flow"
                : "Operational awareness for your role";
}

<div class="page-shell">
    <div class="page-header">
        <div class="space-y-2">
            <div class="inline-flex items-center gap-2 rounded-full bg-brand-50 text-brand-700 px-3 py-1 text-xs font-semibold uppercase tracking-wide">Dashboard</div>
            <p class="text-[13px] text-slate-500 font-medium">@roleIntent</p>
            <div>
                <h1 class="page-title">Welcome back, @Model.UserDisplayName</h1>
                <div class="flex items-center gap-3 flex-wrap text-sm">
                    <p class="page-subtitle">@Model.Now.ToString("dddd, MMMM dd, yyyy") · @Model.Now.ToString("h:mm tt")</p>
                    <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold @statusBadgeClass">
                        <span class="h-2 w-2 rounded-full bg-current"></span>
                        @Model.ClinicStatusLabel
                    </span>
                </div>
            </div>
        </div>
        <div class="flex flex-wrap gap-3">
            <a href="@Url.Action("Index", "Appointments")" class="@secondaryCta">View Schedule</a>
            <a href="@Url.Action("Index", "Patients")" class="@primaryCta">Add Patient</a>
        </div>
    </div>

    <div id="dashboard-live-section"
         data-partial-url="@Url.Action("DashboardLiveTiles", "Home", new { bucketMinutes = Model.SelectedBucketMinutes, startHour = Model.StartHour, endHour = Model.EndHour })">
        <p class="text-xs text-slate-500 mb-2">KPIs: Aggregated metrics for operational awareness across today’s flow.</p>
        @await Html.PartialAsync("_LiveTiles", Model)
    </div>

    <div class="space-y-4">
        <div class="flex items-center justify-between">
            <div>
                <h2 class="section-heading">Quick Actions</h2>
                <p class="section-caption">High-frequency tasks surfaced for today</p>
            </div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            @foreach (var action in Model.QuickActions)
            {
                <partial name="_QuickActionCard" model="action" />
            }
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <details class="surface p-6 space-y-4" @(isAdmin ? "open" : "")>
            <summary class="flex items-center justify-between cursor-pointer select-none">
                <div>
                    <h3 class="section-heading">Alerts</h3>
                    <p class="text-xs text-slate-500">Clinical flags (High Risk, Chronic, Late) highlight where escalation is needed.</p>
                </div>
                <span class="text-sm text-brand-700 hover:text-brand-800">View details</span>
            </summary>
            <div class="space-y-3 pt-2">
                @foreach (var alert in Model.Alerts)
                {
                    <div class="flex items-start gap-3 p-3 rounded-xl border border-slate-100 bg-slate-50/60">
                        <div class="h-9 w-9 rounded-lg bg-amber-100 text-amber-700 flex items-center justify-center">⚠️</div>
                        <div>
                            <div class="font-semibold text-slate-900">@alert.Title</div>
                            <p class="text-sm text-slate-500">@alert.Description</p>
                        </div>
                    </div>
                }
            </div>
        </details>

        <details class="surface p-6 space-y-4" @(isAdmin ? "open" : "")>
            <summary class="flex items-center justify-between cursor-pointer select-none">
                <div>
                    <h3 class="section-heading">Tasks</h3>
                    <p class="text-xs text-slate-500">Saved views reduce repetitive filtering; open for prioritized follow-ups.</p>
                </div>
                <span class="text-sm text-brand-700 hover:text-brand-800">See more</span>
            </summary>
            <div class="space-y-3 pt-2">
                @foreach (var task in Model.Tasks)
                {
                    <div class="flex items-center justify-between p-3 rounded-xl border border-slate-100">
                        <div>
                            <div class="font-semibold text-slate-900">@task.Title</div>
                            <p class="text-sm text-slate-500">@task.Details</p>
                        </div>
                        <span class="badge-soft blue">@task.Status</span>
                    </div>
                }
            </div>
        </details>
    </div>

    <div class="space-y-4">
        <div class="flex items-center justify-between">
            <div>
                <h2 class="section-heading">Modules</h2>
                <p class="section-caption">Jump to key areas of the platform</p>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            @foreach (var module in Model.Modules)
            {
                <partial name="_ModuleCard" model="module" />
            }
        </div>
    </div>
</div>
