<aside id="sidebar" class="fixed left-0 top-20 w-64 h-[calc(100vh-5rem)] bg-white/95 backdrop-blur border-r border-slate-200 shadow-sm overflow-y-auto z-40">
    <nav class="p-4 flex flex-col h-full space-y-6">
        @{
            var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
            var isAdmin = User.IsInRole(nameof(AppRole.Admin));
            var isPhysician = User.IsInRole(nameof(AppRole.Physician));
            var isNurse = User.IsInRole(nameof(AppRole.Nurse));
            var isBilling = User.IsInRole(nameof(AppRole.Billing));
            var isReceptionist = User.IsInRole(nameof(AppRole.Receptionist));

            var dashboardAction = isPhysician ? "DoctorDashboard" : "Index";
            var showPatients = isAdmin || isPhysician || isNurse || isReceptionist;
            var showAppointments = isAdmin || isPhysician || isNurse || isReceptionist;
            var showSchedulingOps = isAdmin || isReceptionist;
            var showStaff = isAdmin;
            var showBilling = isAdmin || isBilling;
            var showReports = isAdmin || isPhysician || isBilling;
            var showSettings = isAdmin;

            var menuItems = new List<(string Controller, string Action, string Label, string Icon, string Description, bool Visible)>
            {
                ("Home", dashboardAction, "Dashboard", "home", "Overview & workload", true),
                ("Patients", "Index", "Patients", "users", "Records", showPatients),
                ("Appointments", "Index", "Appointments", "calendar", "Scheduling", showAppointments)
            };

            if (showSchedulingOps)
            {
                menuItems.Add(("Schedule", "Index", "Working Hours", "briefcase", "Weekly shifts & rooms", true));
                menuItems.Add(("Planning", "Index", "Vacations", "clock", "Absences & leave", true));
            }

            if (showStaff)
            {
                menuItems.Add(("Medecin", "Index", "Doctors", "user-md", "Staff management", true));
            }

            if (showBilling)
            {
                menuItems.Add(("Billing", "Index", "Billing", "briefcase", "Invoices & payments", true));
            }

            if (showReports)
            {
                menuItems.Add(("Reports", "Index", "Reports", "calendar", "Analytics & exports", true));
            }

            if (showSettings)
            {
                menuItems.Add(("Settings", "Index", "Settings", "cog", "System preferences", true));
            }

            var clinicalControllers = new[] { "Home", "Patients", "Appointments", "Schedule", "Planning" };
            var clinicalNav = menuItems.Where(m => m.Visible && clinicalControllers.Contains(m.Controller));
            var adminNav = menuItems.Where(m => m.Visible && !clinicalControllers.Contains(m.Controller));
        }

        <div class="card p-4 space-y-6">
            <div class="bg-slate-50 border border-slate-200 rounded-xl p-3">
                <div class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Clinical console</div>
                <p class="text-sm text-slate-700 mt-1">Navigate by role and module.</p>
            </div>

            <div class="space-y-3">
                <div>
                    <div class="mb-2 px-2 text-[11px] font-semibold uppercase tracking-wide text-slate-500">Clinical</div>
                    <div class="space-y-2">
                        @foreach (var item in clinicalNav)
                        {
                            var isActive = string.Equals(currentController, item.Controller, StringComparison.OrdinalIgnoreCase);
                            <a href="@Url.Action(item.Action, item.Controller)"
                               aria-current="@(isActive ? "page" : null)"
                               class="nav-link @(isActive ? "nav-link-active" : "nav-link-idle")">
                                <span class="h-9 w-9 rounded-lg flex items-center justify-center @(isActive ? "bg-white text-brand-700 shadow-sm" : "bg-slate-100 text-slate-600")">
                                    @if (item.Icon == "home") {
                                        <span class="iconify w-5 h-5" data-icon="solar:home-2-bold"></span>
                                    }
                                    else if (item.Icon == "users") {
                                        <span class="iconify w-5 h-5" data-icon="solar:users-group-rounded-bold"></span>
                                    }
                                    else if (item.Icon == "calendar") {
                                        <span class="iconify w-5 h-5" data-icon="solar:calendar-bold"></span>
                                    }
                                    else if (item.Icon == "briefcase") {
                                        <span class="iconify w-5 h-5" data-icon="solar:case-bold"></span>
                                    }
                                    else if (item.Icon == "clock") {
                                        <span class="iconify w-5 h-5" data-icon="solar:clock-circle-bold"></span>
                                    }
                                    else if (item.Icon == "user-md") {
                                        <span class="iconify w-5 h-5" data-icon="solar:stethoscope-bold"></span>
                                    }
                                    else if (item.Icon == "cog") {
                                        <span class="iconify w-5 h-5" data-icon="solar:settings-bold"></span>
                                    }
                                </span>
                                <div class="flex-1">
                                    <div class="text-sm font-semibold">@item.Label</div>
                                    <p class="text-xs text-slate-500">@item.Description</p>
                                </div>
                                @if (isActive)
                                {
                                    <span class="badge info">Active</span>
                                }
                            </a>
                        }
                    </div>
                </div>

                @if (adminNav.Any())
                {
                    <div class="space-y-2">
                        <div class="mb-2 px-2 text-[11px] font-semibold uppercase tracking-wide text-slate-500">Administrative</div>
                        @foreach (var item in adminNav)
                        {
                            var isActive = string.Equals(currentController, item.Controller, StringComparison.OrdinalIgnoreCase);
                            <a href="@Url.Action(item.Action, item.Controller)"
                               aria-current="@(isActive ? "page" : null)"
                               class="nav-link @(isActive ? "nav-link-active" : "nav-link-idle")">
                                <span class="h-9 w-9 rounded-lg flex items-center justify-center @(isActive ? "bg-white text-brand-700 shadow-sm" : "bg-slate-100 text-slate-600")">
                                    @if (item.Icon == "home") {
                                        <span class="iconify w-5 h-5" data-icon="solar:home-2-bold"></span>
                                    }
                                    else if (item.Icon == "users") {
                                        <span class="iconify w-5 h-5" data-icon="solar:users-group-rounded-bold"></span>
                                    }
                                    else if (item.Icon == "calendar") {
                                        <span class="iconify w-5 h-5" data-icon="solar:calendar-bold"></span>
                                    }
                                    else if (item.Icon == "briefcase") {
                                        <span class="iconify w-5 h-5" data-icon="solar:case-bold"></span>
                                    }
                                    else if (item.Icon == "clock") {
                                        <span class="iconify w-5 h-5" data-icon="solar:clock-circle-bold"></span>
                                    }
                                    else if (item.Icon == "user-md") {
                                        <span class="iconify w-5 h-5" data-icon="solar:stethoscope-bold"></span>
                                    }
                                    else if (item.Icon == "cog") {
                                        <span class="iconify w-5 h-5" data-icon="solar:settings-bold"></span>
                                    }
                                </span>
                                <div class="flex-1">
                                    <div class="text-sm font-semibold">@item.Label</div>
                                    <p class="text-xs text-slate-500">@item.Description</p>
                                </div>
                                @if (isActive)
                                {
                                    <span class="badge info">Active</span>
                                }
                            </a>
                        }
                    </div>
                }
            </div>
        </div>

        <div class="mt-auto pt-6 border-t border-slate-100">
            <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post">
                <button type="submit" class="w-full btn btn-secondary justify-center text-red-600 border-red-100 hover:border-red-200 hover:bg-red-50 py-3 rounded-xl flex items-center gap-2 transition-all">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="w-5 h-5"><path stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span class="text-sm font-bold">Sign Out</span>
                </button>
            </form>
        </div>
    </nav>
</aside>
